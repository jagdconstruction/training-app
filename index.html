<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Jag'd Safety Training</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 980px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.5;
      background: #f9f9f9;
    }

    h1 {
      text-align: center;
      margin: 10px 0 5px;
      font-size: 2rem;
    }

    h3 {
      text-align: center;
      margin: 0 0 20px;
      font-weight: normal;
      color: #444;
    }

    .lang-switcher {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-bottom: 15px;
    }

    .lang-btn {
      padding: 6px 14px;
      font-size: 0.9rem;
      border-radius: 5px;
      border: 1px solid #007bff;
      background: #e8f1ff;
      cursor: pointer;
      font-weight: 600;
    }

    .lang-btn.active {
      background: #007bff;
      color: #fff;
    }

    .video-container {
      margin-top: 20px;
    }

    video {
      width: 100%;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    #ackSection {
      display: none;
      margin-top: 20px;
      background: #eef2f5;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #cdd3d8;
      font-size: 1.05rem;
    }

    #ackLabel input {
      transform: scale(1.2);
      margin-right: 10px;
    }

    #continueSection {
      display: none;
      margin-top: 20px;
      text-align: center;
    }

    #continueBtn {
      font-size: 1.2rem;
      padding: 12px 24px;
      background: #007acc;
      color: #fff;
      border-radius: 6px;
      text-decoration: none;
      display: inline-block;
      font-weight: bold;
    }

    #continueBtn:hover {
      background: #005fa3;
    }
  </style>
</head>

<body>

  <!-- Language Toggle -->
  <div class="lang-switcher">
    <button id="enBtn" class="lang-btn active">English</button>
    <button id="esBtn" class="lang-btn">Español</button>
  </div>

  <!-- Updated Header -->
  <h1 id="page-title">Jag'd Safety Training</h1>
  <h3 id="page-subtitle">Once video is completed, check the box below to proceed.</h3>

  <!-- Training Video -->
  <div class="video-container">
    <video id="trainingVideo" controls>
      <source src="OSHA_Training_Video.mp4" type="video/mp4">
      Your browser does not support MP4 playback.
    </video>
  </div>

  <!-- Acknowledgment Section -->
  <div id="ackSection">
    <label id="ackLabel">
      <input type="checkbox" id="ackCheckbox">
      I confirm that I have watched the entire safety training video. I acknowledge this video is only part of my training. Additional safety rules and procedures are covered in the written training materials provided, which I have been trained on.
    </label>
  </div>

  <!-- Continue Button -->
  <div id="continueSection">
    <a id="continueBtn" href="#">
      Continue to Training Application →
    </a>
  </div>

  <!-- SCRIPT -->
  <script>
    // --------------------------------------------------
    // PM -> ADOBE LINK ROUTING (OPTION 4)
    // --------------------------------------------------
    const ADOBE_FORMS = {
      al:  "https://na2.documents.adobe.com/public/esignWidget?wid=CBFCIBAA3AAABLblqZhADrjyP7HxFJzwACIwPgGmso3tesU54LTwQOhEmzhmaUbWPLQFkWSzJW_bNWVB99Pc*",
      gkl: "https://na2.documents.adobe.com/public/esignWidget?wid=CBFCIBAA3AAABLblqZhAeQC4kXs2uDABn1Bc2Tu7usWGWVYEXu61lQlLM99TMzaRpmkgCsCGCKHhh8B1dMKY*",
      wl:  "https://na2.documents.adobe.com/public/esignWidget?wid=CBFCIBAA3AAABLblqZhDz_RYycqM0ifJcPL57igTEUUt2HuMmiZ-NNZL1-vhg981-4TaehTUlnzKLMEj3ZGE*",
      gg:  "https://na2.documents.adobe.com/public/esignWidget?wid=CBFCIBAA3AAABLblqZhAAb3eKJ3crQp2NBo-u6BUUnAGvqfdEdNmDP6OmSM4GwaLP_OMgW09pDqVmlMYemB4*"
    };

    function resolveAdobeUrl() {
      const pm = (new URLSearchParams(window.location.search).get("pm") || "").toLowerCase();
      return ADOBE_FORMS[pm] || null;
    }

    const ADOBE_SIGN_URL = resolveAdobeUrl();

    // --------------------------------------------------
    // VIDEO + SCRUBBING LOCK
    // --------------------------------------------------
    const video = document.getElementById('trainingVideo');
    let lastAllowedTime = 0;

    // Track current language so alerts match language button selection
    let currentLang = "en";

    // Set the Continue button href based on ?pm=
    const continueBtn = document.getElementById("continueBtn");
    if (ADOBE_SIGN_URL) {
      continueBtn.href = ADOBE_SIGN_URL;
    } else {
      continueBtn.href = "#";
    }

    // If someone lands on index.html without a PM code, block final navigation
    continueBtn.addEventListener("click", function (e) {
      if (!ADOBE_SIGN_URL) {
        e.preventDefault();
        alert(
          currentLang === "es"
            ? "Falta el enlace del formulario. Use el enlace proporcionado por su gerente de proyecto."
            : "Missing training form link. Please use the link provided by your project manager."
        );
      }
    });

    // --------------------------------------------------
    // DISABLE SCRUBBING / SEEKING FORWARD
    // --------------------------------------------------
    video.addEventListener('timeupdate', function () {
      if (video.currentTime > lastAllowedTime + 0.35) {
        video.currentTime = lastAllowedTime;
      } else {
        lastAllowedTime = video.currentTime;
      }
    });

    video.addEventListener('seeking', function () {
      if (video.currentTime > lastAllowedTime) {
        video.currentTime = lastAllowedTime;
      }
    });

    // --------------------------------------------------
    // SHOW ACKNOWLEDGMENT AFTER VIDEO ENDS
    // --------------------------------------------------
    video.addEventListener('ended', function () {
      document.getElementById('ackSection').style.display = 'block';
    });

    // --------------------------------------------------
    // SHOW CONTINUE BUTTON AFTER CHECKBOX CLICKED
    // --------------------------------------------------
    function bindCheckbox() {
      const checkbox = document.getElementById('ackCheckbox');
      checkbox.addEventListener('change', function () {
        document.getElementById('continueSection').style.display =
          checkbox.checked ? 'block' : 'none';
      });
    }
    bindCheckbox();

    // --------------------------------------------------
    // LANGUAGE TOGGLE
    // --------------------------------------------------
    const enText = {
      title: "Jag'd Safety Training",
      subtitle: "Once video is completed, check the box below to proceed.",
      ack: "I confirm that I have watched the entire safety training video. I acknowledge this video is only part of my training. Additional safety rules and procedures are covered in the written training materials provided, which I have been trained on.",
      continue: "Continue to Training Application →"
    };

    const esText = {
      title: "Capacitación de Seguridad Jag'd",
      subtitle: "Una vez que termine el video, marque la casilla a continuación para continuar.",
      ack: "Confirmo que he visto el video completo de capacitación de seguridad. Reconozco que este video es solo una parte de mi capacitación. Reglas y procedimientos de seguridad adicionales están incluidos en los materiales escritos que he recibido y en los cuales he sido capacitado.",
      continue: "Continuar a la Solicitud de Capacitación →"
    };

    document.getElementById('enBtn').addEventListener('click', function () {
      currentLang = "en";
      document.documentElement.lang = "en";

      this.classList.add('active');
      document.getElementById('esBtn').classList.remove('active');

      document.getElementById('page-title').innerText = enText.title;
      document.getElementById('page-subtitle').innerText = enText.subtitle;

      // Rebuild checkbox + text (same as your current behavior)
      document.getElementById('ackLabel').innerHTML =
        '<input type="checkbox" id="ackCheckbox"> ' + enText.ack;

      // IMPORTANT: Hide continue section when swapping language so user must re-check
      document.getElementById('continueSection').style.display = 'none';

      bindCheckbox();
      document.getElementById('continueBtn').innerText = enText.continue;
    });

    document.getElementById('esBtn').addEventListener('click', function () {
      currentLang = "es";
      document.documentElement.lang = "es";

      this.classList.add('active');
      document.getElementById('enBtn').classList.remove('active');

      document.getElementById('page-title').innerText = esText.title;
      document.getElementById('page-subtitle').innerText = esText.subtitle;

      // Rebuild checkbox + text (same as your current behavior)
      document.getElementById('ackLabel').innerHTML =
        '<input type="checkbox" id="ackCheckbox"> ' + esText.ack;

      // IMPORTANT: Hide continue section when swapping language so user must re-check
      document.getElementById('continueSection').style.display = 'none';

      bindCheckbox();
      document.getElementById('continueBtn').innerText = esText.continue;
    });
  </script>

</body>
</html>
